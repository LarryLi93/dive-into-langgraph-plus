{"version":3,"kind":"Notebook","sha256":"c24de3b8dcf693710a32e10363f19a28f0971af599de1f7729874dac5ed14717","slug":"quickstart","location":"/1.quickstart.ipynb","dependencies":[],"frontmatter":{"title":"快速入门","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"base","language":"python"},"authors":[{"nameParsed":{"literal":"Larry Li","given":"Larry","family":"Li"},"name":"Larry Li","id":"contributors-Users\\Lenovo\\Desktop\\product\\dive-into-langgraph-plus\\myst-generated-uid-0"}],"github":"https://github.com/LarryLi93/dive-into-langgraph-plus","exports":[{"format":"ipynb","filename":"1.quickstart.ipynb","url":"/1.quickstart-4e4661968ee62c70b2f0a5b84e3ed567.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/agents#tool-use-in-the-react-loop","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ReAct Agent","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MpjugKzMV6"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/agents#tool-use-in-the-react-loop","key":"S9oiff6vPc"},{"type":"text","value":" 是一种将 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DXEW0D4lCc"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"推理","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aQSQcynfET"}],"key":"pi0CdZB3JQ"},{"type":"text","value":"（Reasoning）与 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BoV0QSBfOn"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"行动","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HdltGkcE1W"}],"key":"A5tA3b7TLV"},{"type":"text","value":"（Acting）结合起来的智能体。它是智能体的核心科技，也是智能体框架中最能表现其自主性的组件。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vfMMevTfqk"}],"key":"WcboeHI1vq"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"它的工作流程遵循三步循环：","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xFlGcuAKNx"}],"key":"TBICE7uZ8V"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"思考","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"v3CR5rP5fb"}],"key":"eJ7NzjxtKf"}],"key":"ES6uNpWZXX"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"行动","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"rRscZtXZ8U"}],"key":"G8DyDZGa2K"}],"key":"aYAxVl2DE3"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"观察","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"pDvc0NbEdW"}],"key":"CLIk73YBDK"}],"key":"zIk4QqqTHg"}],"key":"DxNL0CStEn"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"这个循环会持续进行，直到 LLM 判断任务已经完成或无法继续。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"GVY1kmXGdr"}],"key":"wpqcS7p3jm"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"这种循环意味着智能体可以通过工具调用，自动补足当前未知的上下文信息。然后基于新获取的信息，做出下一步决策。比如你要智能体查询一个数据表中的记录，它可能尚不知道数据库中有哪些表，表中有哪些字段。但是通过几轮的主动查询与观察，即使你询问的信息比较模糊，它大概率也能从表名和字段名中推测出你需要的记录是哪一条。这就是 ReAct Agent 的威力。","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"hehjQtNRXm"}],"key":"NWkCTiEumm"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"本节将介绍：","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"STIgNHppfO"}],"key":"LkuwfT0PEG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"如何创建简单的 ReAct Agent","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"xWYLl0l0az"}],"key":"RI4Y6u0uHC"}],"key":"f5gSaTj7fg"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"如何创建带工具的 ReAct Agent","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"kGr6WSkoGQ"}],"key":"Qh71pyiKiw"}],"key":"jjl5qP8HLD"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"如何创建带工具权限的 ReAct Agent","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"DaV3SdyK9t"}],"key":"D5EBqipxSb"}],"key":"maQpwqQJFo"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"结构化输出","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"jZaluEVYv9"}],"key":"KGCqibc54I"}],"key":"Skn5hiuljE"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"流式输出","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"y9FadESo5x"}],"key":"oV2LAkkaD2"}],"key":"erpllrnGu5"}],"key":"we6MaXxjhd"},{"type":"heading","depth":2,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"一、环境配置","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"tcg7nekcRj"}],"identifier":"id","label":"一、环境配置","html_id":"id","implicit":true,"key":"O0jPMq0OkN"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"strong","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"1）安装依赖","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"U0U0Z6vYUG"}],"key":"AXloKeCUF6"}],"key":"FT60i6kavh"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"你可以下载 ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"TNyKbA2wgT"},{"type":"link","url":"https://github.com/luochang212/dive-into-langgraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"本仓库","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"cdVVXGXRsS"}],"urlSource":"https://github.com/luochang212/dive-into-langgraph","error":true,"key":"giZrNIbmnD"},{"type":"text","value":" 到本地，运行以下命令，安装完整的 Python 依赖：","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"pqvNs2WnBB"}],"key":"ixis6w1s39"},{"type":"code","lang":"bash","value":"cd dive-into-langgraph\npip install -r requirements.txt","position":{"start":{"line":30,"column":1},"end":{"line":33,"column":1}},"key":"sDcxNFrMdg"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"依赖包列表","key":"vcxq3tFBQC"}],"key":"hGmjRgWTYB"},{"type":"paragraph","children":[{"type":"text","value":"以下为 ","key":"Me2uAdnr20"},{"type":"inlineCode","value":"requirements.txt","key":"ogpHmnzbFI"},{"type":"text","value":" 中的依赖包清单：","key":"iUBZ8saHpq"}],"key":"kzNkWcQEYt"},{"type":"code","lang":"text","meta":null,"value":"pydantic\npython-dotenv\nlangchain[openai]\nlangchain-community\nlangchain-mcp-adapters\nlangchain-text-splitters\nlanggraph\nlanggraph-cli[inmem]\nlanggraph-supervisor\nlanggraph-checkpoint-sqlite\nlangmem\nipynbname\nfastmcp\nbs4","key":"vQ2LxJ4C5c"}],"key":"AI1z7nyVCG"},{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"或者，你也可以直接安装 LangGraph，遇到缺少的依赖再行安装：","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"Kw9AAZTHKF"}],"key":"Fg5zxvzAl0"},{"type":"code","lang":"bash","value":"pip install langgraph langchain","position":{"start":{"line":60,"column":1},"end":{"line":62,"column":1}},"key":"O9i3GyPbD3"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"strong","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"2）导入依赖","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"EL6JcwX3BP"}],"key":"Zm9sn1EVvU"}],"key":"CrvaoMchsZ"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"使用 .env.example 创建 .env 文件:","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"s6YDCdycLI"}],"key":"WuPJnhBKW7"},{"type":"code","lang":"bash","value":"cp .env.example .env","position":{"start":{"line":68,"column":1},"end":{"line":70,"column":1}},"key":"ZL7vogSvay"},{"type":"blockquote","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"PS: 本教程使用阿里百炼平台的模型。你需要在 ","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"TD1x7dNf7p"},{"type":"link","url":"https://www.aliyun.com/product/bailian","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"阿里百炼平台","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"Idt1TePYZ6"}],"urlSource":"https://www.aliyun.com/product/bailian","key":"R0ByWHkZPT"},{"type":"text","value":" 注册账号，并将获得的 API 密钥填入 .env 文件中的 ","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"rSOq7pAbI7"},{"type":"inlineCode","value":"DASHSCOPE_API_KEY","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"dRQeUdkcpA"},{"type":"text","value":" 变量。","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"C5SabkOpOj"}],"key":"UmdUWgsoUr"}],"key":"ORXcWDbNNV"}],"key":"CNHa8ck9l8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nfrom dotenv import load_dotenv\nfrom langchain_openai import ChatOpenAI\nfrom langchain.agents import create_agent\n\n# 加载模型配置\n# 请事先在 .env 中配置 DASHSCOPE_API_KEY\n_ = load_dotenv()","key":"qmMXJiA8St"},{"type":"outputs","id":"NHBMuHU6rWPsM7KOwRwp6","children":[],"key":"aj7v7wOPWP"}],"key":"mQcO1yOYTb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"二、简单的 Agent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xRAkm8r0lq"}],"identifier":"id-agent","label":"二、简单的 Agent","html_id":"id-agent","implicit":true,"key":"s29rmbocoQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"首先，创建一个最简单的 ReAct Agent。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zGHJBCWVGU"}],"key":"g6NiGGvOHw"}],"key":"gPh4I0l0KJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 配置大模型服务\nllm = ChatOpenAI(\n    api_key=os.getenv(\"DASHSCOPE_API_KEY\"),\n    base_url=os.getenv(\"DASHSCOPE_BASE_URL\"),\n    model=\"qwen3-coder-plus\",\n)\n\n# 创建一个简单的Agent\nagent = create_agent(\n    model=llm,\n    system_prompt=\"You are a helpful assistant\",\n)\n\n# 运行Agent\nresponse = agent.invoke({'messages': '你好'})\n\nresponse['messages'][-1].content","key":"f4jXk1ou7P"},{"type":"outputs","id":"P5bHyO4-ayWLGx26-JQqE","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"'你好！很高兴见到你。有什么我可以帮助你的吗？'","content_type":"text/plain"}}},"children":[],"key":"h6XB3DbmKu"}],"key":"N5bJ9bHgkC"}],"key":"e52V2de2aa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 可视化 Agent\nagent","key":"tnJSsYsCfl"},{"type":"outputs","id":"FI8A2aYghJHJZkkil2l_S","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b51000fa4c78f6b6f1e914b2c963b96d","path":"/b51000fa4c78f6b6f1e914b2c963b96d.png"},"text/plain":{"content":"<langgraph.graph.state.CompiledStateGraph object at 0x10fe346e0>","content_type":"text/plain"}}},"children":[],"key":"opPOewIu1e"}],"key":"Nqf2n3Mz1p"}],"key":"sqtNzLIr8e"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"三、带工具调用的 Agent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"im9qjMLq0g"}],"identifier":"id-agent","label":"三、带工具调用的 Agent","html_id":"id-agent-1","implicit":true,"key":"ax842q1NsE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"接下来，我们创建一个带工具调用的 ReAct Agent，它会根据需求自主决定是否调用工具。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dDEq3DgX8H"}],"key":"Jpn1kuZ73H"}],"key":"SLJXNqQ1xv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 一个工具函数\ndef get_weather(city: str) -> str:\n    \"\"\"Get weather for a given city.\"\"\"\n    return f\"It's always sunny in {city}!\"\n\n# 创建带工具调用的Agent\ntool_agent = create_agent(\n    model=llm,\n    tools=[get_weather],\n    system_prompt=\"You are a helpful assistant\",\n)\n\n# 运行Agent\nresponse = tool_agent.invoke(\n    {\"messages\": [{\"role\": \"user\", \"content\": \"what is the weather in sf\"}]}\n)\n\nresponse['messages'][-1].content","key":"Wa5sI3kYZa"},{"type":"outputs","id":"gskq32r8bCxfFXl0rrH1_","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"\"It's always sunny in sf!\"","content_type":"text/plain"}}},"children":[],"key":"lK2nHmPub3"}],"key":"Tk2qvMgvL3"}],"key":"kTR7NJvEvR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 可视化 Agent\ntool_agent","key":"Q2z8OPF4dz"},{"type":"outputs","id":"mSaA5nW4X82HSXqDC_uqP","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b1a717b5cdc91dfdcf44b402f7b24173","path":"/b1a717b5cdc91dfdcf44b402f7b24173.png"},"text/plain":{"content":"<langgraph.graph.state.CompiledStateGraph object at 0x10fe74050>","content_type":"text/plain"}}},"children":[],"key":"Xk96EJqWpu"}],"key":"SwFksczydU"}],"key":"pWrO7dooGE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"四、使用 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"elFycyyxEH"},{"type":"inlineCode","value":"ToolRuntime","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E5LbxO9pUh"},{"type":"text","value":" 控制工具权限","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e86Z3hRvzT"}],"identifier":"id-toolruntime","label":"四、使用 ToolRuntime 控制工具权限","html_id":"id-toolruntime","implicit":true,"key":"SdF9SEeXNY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"下面创建一个带 runtime 的工具，runtime 类型为 ToolRuntime。当我们调用 Agent 时，会将这个 runtime 通过 context 参数传递给工具。工具再根据 runtime 中的信息，判断当前调用是否具备执行权限。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ORwOLAoyCN"}],"key":"zoTeyEEIs7"}],"key":"lNDkAyR8zF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from typing import Literal, Any\nfrom pydantic import BaseModel\nfrom langchain.tools import tool, ToolRuntime\n\nclass Context(BaseModel):\n    authority: Literal[\"admin\", \"user\"]\n\n# 创建带权限控制的tool，依赖ToolRuntime的内容进行判断\n@tool\ndef math_add(runtime: ToolRuntime[Context, Any], a: int, b: int) -> int:\n    \"\"\"Add two numbers together.\"\"\"\n    authority = runtime.context.authority\n    # 只有admin用户可以访问加法工具\n    if authority != \"admin\":\n        raise PermissionError(\"User does not have permission to add numbers\")\n    return a + b\n\n# 创建带工具调用的Agent\ntool_agent = create_agent(\n    model=llm,\n    tools=[get_weather, math_add],\n    system_prompt=\"You are a helpful assistant\",\n)\n\n# 在运行Agent时注入context\nresponse = tool_agent.invoke(\n    {\"messages\": [{\"role\": \"user\", \"content\": \"请计算 8234783 + 94123832 = ?\"}]},\n    config={\"configurable\": {\"thread_id\": \"1\"}},\n    context=Context(authority=\"admin\"),\n)","key":"o2TMhKGtNz"},{"type":"outputs","id":"sOJ8Wvlfd0OBUHWxZr1QK","children":[],"key":"sDZIqWCs6o"}],"key":"h3L3hUge9H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for message in response['messages']:\n    message.pretty_print()","key":"iRqggpyEf8"},{"type":"outputs","id":"k4TEoUesWIKxZuYS_ywyB","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"================================\u001b[1m Human Message \u001b[0m=================================\n\n请计算 8234783 + 94123832 = ?\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  math_add (call_297ec3b6688146318666f841)\n Call ID: call_297ec3b6688146318666f841\n  Args:\n    a: 8234783\n    b: 94123832\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: math_add\n\n102358615\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n8234783 + 94123832 = 102358615\n"},"children":[],"key":"q2swsKAlHW"}],"key":"oRzwGIaJJV"}],"key":"H3k34J3eXV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 验证计算结果是否正确\n8234783 + 94123832","key":"dMLknObU9u"},{"type":"outputs","id":"mG4qxdingfTboNqSmHAax","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"102358615","content_type":"text/plain"}}},"children":[],"key":"UuNEinJsTO"}],"key":"Cqbjxej3qo"}],"key":"ApRJfVIOr9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"五、结构化输出","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vjj0arzo0Y"}],"identifier":"id","label":"五、结构化输出","html_id":"id-1","implicit":true,"key":"iMESqmtVz7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"若想获得结构化输出（Structured Output），可以在 create_agent 函数的 response_format 参数进行设定。在下面这个例子中，我们用 BaseModel 定义输出格式，然后在 response_format 中指定该格式。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BjGLzriQOR"}],"key":"Qll43rWH19"}],"key":"tPoWRr46MQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pydantic import BaseModel, Field\n\nclass CalcInfo(BaseModel):\n    \"\"\"Calculation information.\"\"\"\n    output: int = Field(description=\"The calculation result\")","key":"zch2OKQKq1"},{"type":"outputs","id":"3o9y4I8zJmfDmuitvg6OK","children":[],"key":"E0CAaGoCHD"}],"key":"bcLsWmPGEK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 创建带结构化输出的Agent\nstructured_agent = create_agent(\n    model=llm,\n    tools=[get_weather, math_add],\n    system_prompt=\"You are a helpful assistant\",\n    response_format=CalcInfo,\n)\n\nresponse = structured_agent.invoke(\n    {\"messages\": [{\"role\": \"user\", \"content\": \"请计算 8234783 + 94123832 = ?\"}]},\n    config={\"configurable\": {\"thread_id\": \"1\"}},\n    context=Context(authority=\"admin\"),\n)","key":"Ajmy4iW548"},{"type":"outputs","id":"9bWlBiOSsxe6PGOBiVLpB","children":[],"key":"NnAhp0com7"}],"key":"a6iFBUSxnB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for message in response['messages']:\n    message.pretty_print()","key":"fd0FMD8zr3"},{"type":"outputs","id":"3079RbNariCsOVfflsiko","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"================================\u001b[1m Human Message \u001b[0m=================================\n\n请计算 8234783 + 94123832 = ?\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  math_add (call_a16b4eac861e42d5a052a54a)\n Call ID: call_a16b4eac861e42d5a052a54a\n  Args:\n    a: 8234783\n    b: 94123832\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: math_add\n\n102358615\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  CalcInfo (call_4f1510a52c97492fa5f901d3)\n Call ID: call_4f1510a52c97492fa5f901d3\n  Args:\n    output: 102358615\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: CalcInfo\n\nReturning structured response: output=102358615\n"},"children":[],"key":"wO7kz6FCtB"}],"key":"KINbwuMJgX"}],"key":"L2C7Eoq57u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"response['messages'][-1]","key":"tFyDAk8ECn"},{"type":"outputs","id":"7R1bD3ha2z9n6fVFFUJEb","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"ToolMessage(content='Returning structured response: output=102358615', name='CalcInfo', id='79ca06f2-9c88-4dfa-95f5-3533e9b57041', tool_call_id='call_4f1510a52c97492fa5f901d3')","content_type":"text/plain"}}},"children":[],"key":"x0nuUYlR1P"}],"key":"pjg4pCPZ5e"}],"key":"FgW7ROoFb5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"六、流式输出","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n8BhDV2x1d"}],"identifier":"id","label":"六、流式输出","html_id":"id-2","implicit":true,"key":"HIvRT3cFxB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"下面是一个简单的例子，更多信息请参阅 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zsz062twj4"},{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/streaming","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"streaming","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xjEZbZKien"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/streaming","key":"k4QGZatLyb"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Yt6zER5jAN"}],"key":"c4fWIT2CIP"}],"key":"lznDTmLlHf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"agent = create_agent(\n    model=llm,\n    tools=[get_weather],\n)\n\nfor chunk in agent.stream(  \n    {\"messages\": [{\"role\": \"user\", \"content\": \"What is the weather in SF?\"}]},\n    stream_mode=\"updates\",\n):\n    for step, data in chunk.items():\n        print(f\"step: {step}\")\n        print(f\"content: {data['messages'][-1].content_blocks}\")","key":"yTnh1DDPH2"},{"type":"outputs","id":"yMrFSTLHP8BHryKsFEai6","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"step: model\ncontent: [{'type': 'tool_call', 'name': 'get_weather', 'args': {'city': 'SF'}, 'id': 'call_fae500cd15c24b0294e898ec'}]\nstep: tools\ncontent: [{'type': 'text', 'text': \"It's always sunny in SF!\"}]\nstep: model\ncontent: [{'type': 'text', 'text': 'The weather in SF is always sunny!'}]\n"},"children":[],"key":"hQj0gZaTXQ"}],"key":"XIvr5Ob42b"}],"key":"ATwYwRUqti"}],"key":"pH5euMdGsm"},"references":{"cite":{"order":[],"data":{}}}}