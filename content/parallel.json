{"version":3,"kind":"Notebook","sha256":"fccc84bc5af36879f093d80f9a6e2529a87fda25b6630bd05f8fed63e3643d6b","slug":"parallel","location":"/9.parallel.ipynb","dependencies":[],"frontmatter":{"title":"å¹¶è¡Œ","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Larry Li","given":"Larry","family":"Li"},"name":"Larry Li","id":"contributors-Users\\Lenovo\\Desktop\\product\\dive-into-langgraph-plus\\myst-generated-uid-0"}],"github":"https://github.com/LarryLi93/dive-into-langgraph-plus","exports":[{"format":"ipynb","filename":"9.parallel.ipynb","url":"/9.parallel-ede88a35e3544240dc54347634f4598a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"æœ¬èŠ‚ä»‹ç»ä¸¤ç§å®ç°å¹¶è¡Œçš„æ–¹æ³•ï¼š","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Rl1dftNrqA"}],"key":"FpAiZt8HA6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"èŠ‚ç‚¹å¹¶è¡Œ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"a6uwIMwOJM"}],"key":"R0KfKOPmrj"}],"key":"pnvLsKUsUv"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Map-reduce","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"QPHBw7mZ2x"}],"key":"aDYqDWshmw"}],"key":"PsYkDk4s4z"}],"key":"tfQt30CDsq"}],"key":"bCHErswJfM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport time\nimport operator\n\nfrom dotenv import load_dotenv\nfrom typing import Annotated\nfrom datetime import datetime\nfrom pydantic import BaseModel\nfrom typing_extensions import TypedDict\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import HumanMessage\nfrom langgraph.graph import StateGraph, MessagesState, START, END\nfrom langgraph.types import Send\n\n# åŠ è½½æ¨¡å‹é…ç½®\n_ = load_dotenv()\n\n# åŠ è½½æ¨¡å‹\nllm = ChatOpenAI(\n    api_key=os.getenv(\"DASHSCOPE_API_KEY\"),\n    base_url=os.getenv(\"DASHSCOPE_BASE_URL\"),\n    model=\"qwen3-max\",\n    temperature=0.7,\n)","key":"An5clUWFrI"},{"type":"outputs","id":"zJvleTj26CI9v1pakZK4C","children":[],"key":"Chl95RXP4P"}],"key":"YUiTO4TyCx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ä¸€ã€èŠ‚ç‚¹å¹¶è¡Œ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hqbCaD0PMA"}],"identifier":"id","label":"ä¸€ã€èŠ‚ç‚¹å¹¶è¡Œ","html_id":"id","implicit":true,"key":"GIocIcQM9b"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"èŠ‚ç‚¹å¹¶è¡Œå¾ˆå®¹æ˜“å®ç°ï¼Œä½¿ç”¨ ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UY91zW8yP3"},{"type":"inlineCode","value":"StateGraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HIEUnBgqoV"},{"type":"text","value":" åˆ›å»ºå¸¦å¹¶è¡ŒèŠ‚ç‚¹çš„å·¥ä½œæµå°±å¯ä»¥ã€‚","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nQEAYBz2YB"}],"key":"DiUxahdcMk"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹å¹¶è¡Œçš„ä¾‹å­ã€‚ä½ å¯ä»¥è§‚å¯ŸèŠ‚ç‚¹è¿è¡Œçš„æ—¶é—´æˆ³ï¼Œç¡®è®¤å®ƒä»¬æ˜¯å¦çœŸçš„åœ¨å¹¶è¡Œã€‚","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Cvsuxt7MT5"}],"key":"Qxb1fpyyAu"}],"key":"s6unc7yOWG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# åˆ›å»ºå¹¶è¡ŒèŠ‚ç‚¹a\ndef node_a(state: MessagesState):\n    start_time = datetime.now()\n    print(f\"[node_a] è¿›å…¥å‡½æ•°æ—¶é—´: {start_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    # ä½¿ç”¨ sleep æ¨¡æ‹Ÿå ç”¨æ—¶é—´\n    time.sleep(2)\n\n    end_time = datetime.now()\n    print(f\"[node_a] é€€å‡ºå‡½æ•°æ—¶é—´: {end_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    return {'messages': [HumanMessage(\n        content=f'èŠ‚ç‚¹aè¿è¡Œäº†{round((end_time - start_time).total_seconds(), 3)}ç§’'\n    )]}\n\n# åˆ›å»ºå¹¶è¡ŒèŠ‚ç‚¹b\ndef node_b(state: MessagesState):\n    start_time = datetime.now()\n    print(f\"[node_b] è¿›å…¥å‡½æ•°æ—¶é—´: {start_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    # ä½¿ç”¨ sleep æ¨¡æ‹Ÿå ç”¨æ—¶é—´\n    time.sleep(4)\n\n    end_time = datetime.now()\n    print(f\"[node_b] é€€å‡ºå‡½æ•°æ—¶é—´: {end_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    return {'messages': [HumanMessage(\n        content=f'èŠ‚ç‚¹bè¿è¡Œäº†{round((end_time - start_time).total_seconds(), 3)}ç§’'\n    )]}\n\n# åˆ›å»ºå›¾\nbuilder = StateGraph(MessagesState)\n\n# æ·»åŠ èŠ‚ç‚¹\nbuilder.add_node('node_a', node_a)\nbuilder.add_node('node_b', node_b)\n\n# æ·»åŠ è¾¹\nbuilder.add_edge(START, 'node_a')\nbuilder.add_edge(START, 'node_b')\nbuilder.add_edge('node_a', END)\nbuilder.add_edge('node_b', END)\n\n# ç¼–è¯‘å›¾\nmy_graph = builder.compile(name='my-graph')\nmy_graph","key":"k6A45FXOku"},{"type":"outputs","id":"Dz6o4hOVTeiD6iw504GXH","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"62a6f964cab63e743a9eb98e9968d407","path":"/62a6f964cab63e743a9eb98e9968d407.png"},"text/plain":{"content":"<langgraph.graph.state.CompiledStateGraph object at 0x10bbfaa50>","content_type":"text/plain"}}},"children":[],"key":"fUVSh5jnrc"}],"key":"WoQA5SqZFE"}],"key":"N7esCzYdGo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# è°ƒç”¨å›¾\nresponse = my_graph.invoke({\n    'messages': [HumanMessage(content='æ‰§è¡Œ node_a å’Œ node_b')]\n})\n\nfor message in response['messages']:\n    message.pretty_print()","key":"m9RxYG48sh"},{"type":"outputs","id":"VnrXNavbZ6uowQ5IxIkqE","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[node_a] è¿›å…¥å‡½æ•°æ—¶é—´: 2025-12-06 04:57:54.839[node_b] è¿›å…¥å‡½æ•°æ—¶é—´: 2025-12-06 04:57:54.840\n\n[node_a] é€€å‡ºå‡½æ•°æ—¶é—´: 2025-12-06 04:57:56.843\n[node_b] é€€å‡ºå‡½æ•°æ—¶é—´: 2025-12-06 04:57:58.843\n================================\u001b[1m Human Message \u001b[0m=================================\n\næ‰§è¡Œ node_a å’Œ node_b\n================================\u001b[1m Human Message \u001b[0m=================================\n\nèŠ‚ç‚¹aè¿è¡Œäº†2.003ç§’\n================================\u001b[1m Human Message \u001b[0m=================================\n\nèŠ‚ç‚¹bè¿è¡Œäº†4.003ç§’\n"},"children":[],"key":"PEORxcUGmF"}],"key":"XktkTYs36F"}],"key":"h4EleUlfKS"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"pvafZ3LwaF"}],"key":"G8oBrK84ef"},{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[],"key":"HcWtroNG22"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"è‹¥æƒ³äº†è§£å…³äºèŠ‚ç‚¹æ‰§è¡Œé¡ºåºçš„ç»†èŠ‚ï¼Œæ¨èé˜…è¯» ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oxkw7GeVGh"},{"type":"link","url":"https://github.com/langchain-ai/langchain-academy/blob/main/module-4/parallelization.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"parallelizationâ€‹.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"J3XJ8HfRt3"}],"urlSource":"https://github.com/langchain-ai/langchain-academy/blob/main/module-4/parallelization.ipynb","data":{"kind":"file","org":"langchain-ai","repo":"langchain-academy","reference":"main","file":"module-4/parallelization.ipynb","raw":"https://raw.githubusercontent.com/langchain-ai/langchain-academy/main/module-4/parallelization.ipynb"},"internal":false,"protocol":"github","key":"M57WgZs3F6"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CyMNq5wV1w"}],"key":"T4JAIqDAYy"}],"kind":"note","class":"simple","key":"lnzqhsct1D"},{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"äºŒã€Map-reduce","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"N6rQg2C7vp"}],"identifier":"id-map-reduce","label":"äºŒã€Map-reduce","html_id":"id-map-reduce","implicit":true,"key":"lJ1S4qEs5u"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"å­¦è¿‡ ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KdqjFziUxM"},{"type":"link","url":"https://www.luochang.ink/posts/hadoop_intro/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Hadoop","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"npQgbrAbfJ"}],"urlSource":"https://www.luochang.ink/posts/hadoop_intro/","key":"ez3tDJR1pl"},{"type":"text","value":" çš„äººéƒ½çŸ¥é“ï¼Œmap-reduce æ˜¯ä¸€ä¸ªã€Œå…ˆå¹¶è¡Œï¼Œåå½’çº¦ã€çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæ¦‚å¿µè¢«å€Ÿé‰´åˆ° Agent è¿™é‡Œï¼Œå˜æˆäº†ã€Œå…ˆå‘æ•£ï¼Œåæ”¶æ•›ã€ã€‚å€Ÿé‰´è¿‡æ¥ä¹‹åï¼Œå®ƒçš„å†…æ¶µå…¶å®å˜ç®€å•äº†ï¼Œç®€å•åˆ°ä¸ç”¨ LangGraph ä¹Ÿèƒ½å®ç°ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ LangGraph å‘¢ï¼Ÿå½“ç„¶æ˜¯å› ä¸ºç”¨ LangGraph å†™çš„ map-reduce æ›´æ ‡å‡†åŒ–ï¼Œå¯è¯»æ€§ä¹Ÿæ›´å¼ºä¸€äº›ã€‚","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mPbPFIbW1z"}],"key":"erbQ3Y51ZB"},{"type":"admonition","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"X51ImzwROB"}],"key":"CN4PuJRgbJ"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"\nğŸ™† å…«å¦çš„å¿ƒï¼Œå°±æ˜¯çˆ±ï¼ˆç¼–ç¨‹ï¼‰çš„é­”æ³•ã€‚","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IP0Ak3RQjd"}],"key":"ts1ICdMQP5"}],"kind":"note","class":"simple","key":"KwYNOypf4B"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"ä¸‹é¢æˆ‘ä»¬æ¥è§£å†³ä¸€ä¸ªéå¸¸å®é™…çš„é—®é¢˜ï¼šå¥³ç¥ä¸å›æ¶ˆæ¯æ€ä¹ˆåŠï¼ï¼ï¼","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"nerp6WwceY"}],"key":"Yn9y94uQV7"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"æˆ‘ä»¬ä»ä»¥ä¸‹å‡ ç§ç±»å‹çš„ç”·ç”Ÿå…¥æ‰‹ï¼š","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"PnjGRExYnv"}],"key":"aM0sGsjXmn"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ç”·ç¥","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"UBHLWdjxMH"}],"key":"iI3keIEcwT"}],"key":"IxourdMMUb"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"æš–ç”·","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"o11XkcM0gR"}],"key":"wnDVJzvf85"}],"key":"AdOumYxbOg"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"æµ·ç‹","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"T3sN82QVY4"}],"key":"OceWD9yZBn"}],"key":"XZl6XJyD9Z"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ç—´æƒ…ç”·","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"leO5aYR8VP"}],"key":"Rdn3bGpoPO"}],"key":"i4edE1MENV"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"å†³ç»çš„ç”·ç”Ÿ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"OCTb8KX1h0"}],"key":"odQVxR5WV2"}],"key":"SUQqyOGsME"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"èŒ¶èŒ¶çš„ç”·ç”Ÿ ğŸ’…ğŸ’…ğŸ’…","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ZFP6slFPRf"}],"key":"CTM2VHAb4a"}],"key":"zLqz4r1vBz"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ç†æƒ³ä¸»ä¹‰çš„ç”·ç”Ÿ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ymWFwo50k3"}],"key":"eYdXGkBnXU"}],"key":"n3g6lE3n9x"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"å–œæ¬¢å”å˜˜çš„ç”·ç”Ÿ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Xqi14jT5NC"}],"key":"zeQoSbyxKO"}],"key":"H5up5pOGfn"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"å¤§ç”·å­ä¸»ä¹‰çš„ç”·ç”Ÿ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"CNXMI0O4dR"}],"key":"zeenHuOTwe"}],"key":"kFM0PB9k0u"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"äºŒæ¬¡å…ƒè‚¥å®…","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"YTTAYo7oJ8"}],"key":"M6X8NAwApw"}],"key":"SS1hs46yyI"}],"key":"njArIZqgSP"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"ä½ ä¸€å®šéå¸¸å¥½å¥‡ï¼Œä»–ä»¬ä¼šå¦‚ä½•åº”å¯¹ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ­ç§˜ã€‚","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"Y1oxrfimkj"}],"key":"PtMIm1fSSo"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"1ï¼‰åˆ›å»ºä¸Šä¸‹æ–‡çš„ schema","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"VexZNPfDxz"}],"key":"OYsuiMjQAb"}],"key":"poITV3ErTr"}],"key":"uX3OZiEjPz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# è§’è‰²\nclass Roles(BaseModel):\n    roles: list[str]\n\n# å•ä¸ªè§’è‰²\nclass Role(BaseModel):\n    role: str\n\n# å•ä¸ªå›å¤\nclass Response(BaseModel):\n    response: str\n\n# æœ€ä½³å›å¤çš„ ID\nclass BestResponse(BaseModel):\n    id: int\n\n# å…¨å±€ä¸Šä¸‹æ–‡\nclass Overall(TypedDict):\n    roles: list[str]\n    responses: Annotated[list, operator.add]\n    best_response: str","key":"kpoTHa2cPw"},{"type":"outputs","id":"2Zst7L7FoBljPk13vMCRs","children":[],"key":"UAyI135OwD"}],"key":"T5fxyxBKLy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2ï¼‰åˆ›å»ºæç¤ºè¯æ¨¡ç‰ˆ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pe7aoxi7Ya"}],"key":"HVEnJ5Uxzl"}],"key":"kB3oULYjZH"}],"key":"n8OMeI8Ka7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# è§’è‰²çš„æç¤ºè¯\nrole_prompt = \"å¥³ç¥åˆä¸å›ä½ æ¶ˆæ¯äº†ï¼Œä½œä¸ºä¸€ä¸ª{role}ï¼Œä½ åº”è¯¥å¦‚ä½•ä¸€å¥è¯å›å¤å¥³ç¥ï¼Ÿè¯·ä»¥JSONæ ¼å¼è¿”å›ï¼ŒåŒ…å«responseå­—æ®µ\"\n\n# æœ€ä½³å›å¤çš„æç¤ºè¯\nbest_response_prompt = \"\"\"ä¸‹é¢æ˜¯å‡ ç§ç±»å‹çš„ç”·ç”Ÿï¼Œé¢å¯¹å¥³ç¥ä¸å›æ¶ˆæ¯çš„æƒ…å†µï¼Œåšå‡ºçš„ååº”ã€‚\nä½ è§‰å¾—ä»¥ä¸‹å“ªç§å›å¤æœ€èƒ½æŒ½å›å¥³ç¥çš„å¿ƒï¼Œè¯·è¿”å›å¯¹åº”çš„IDã€‚\næ³¨æ„å“¦ï¼Œç¬¬ä¸€æ¡ååº”å¯¹åº”çš„æ˜¯0å·IDã€‚å¹¶ä»¥JSONæ ¼å¼è¿”å›ï¼ŒåŒ…å«idå­—æ®µ\nä¸‹é¢æ˜¯ç”·ç”Ÿä»¬çš„ååº”ï¼š\\n\\n{responses}\"\"\"","key":"vyHc1kE7BA"},{"type":"outputs","id":"ic49Ox5PEM89ewu_lCjYd","children":[],"key":"jxSGmeutbd"}],"key":"rZ3ZTuy4aO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3ï¼‰åˆ›å»ºèŠ‚ç‚¹","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SNhggt0jnT"}],"key":"OmB2XdraK2"}],"key":"IQJmdE0Q8K"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"è¿™é‡Œçš„é­”æ³•åœ¨äºæˆ‘ä»¬ä½¿ç”¨ ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rA8bkKaY5r"},{"type":"link","url":"https://docs.langchain.com/oss/python/langgraph/graph-api#send","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Send","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BDWi9MLUS3"}],"urlSource":"https://docs.langchain.com/oss/python/langgraph/graph-api#send","key":"yOC5UwbwLp"},{"type":"text","value":" å‡½æ•°ï¼Œå°†è§’è‰²åˆ†å‘ç»™ ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DJIhsICUXX"},{"type":"inlineCode","value":"generate_response","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XXGZ3QqOrQ"},{"type":"text","value":" èŠ‚ç‚¹è¿›è¡Œè§’è‰²å›å¤ç”Ÿæˆã€‚","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ACSKic1lNO"}],"key":"fGP3Dboe23"}],"key":"rEZXNBxL4s"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ä½¿ç”¨ Send å‡½æ•°åˆ†å‘è§’è‰²\ndef continue_to_responses(state: Overall):\n    return [ Send(\"generate_response\", {\"role\": r}) for r in state[\"roles\"] ]\n\n# è§’è‰²å›å¤èŠ‚ç‚¹ï¼šç”Ÿæˆæ¯ä¸ªè§’è‰²çš„å›å¤\ndef generate_response(state: Role):\n    prompt = role_prompt.format(role=state[\"role\"])\n    response = llm.with_structured_output(Response).invoke(prompt)\n    return {\"responses\": [response.response]}\n\n# æœ€ä½³å›å¤èŠ‚ç‚¹ï¼šè¿”å›æœ€ä½³å›å¤\ndef best_response(state: Overall):\n    responses = \"\\n\\n\".join(state[\"responses\"])\n    prompt = best_response_prompt.format(responses=responses)\n    response = llm.with_structured_output(BestResponse).invoke(prompt)\n    return {\"best_response\": state[\"responses\"][response.id]}","key":"o5EIZlxC00"},{"type":"outputs","id":"IOejbzIABPHKyotQYcVm7","children":[],"key":"EMgWFLpsXX"}],"key":"AaXja0i6zv"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"lSFzMYT5gA"}],"key":"H0cvoc4Z20"},{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"\næˆ‘ä»¬å…è®¸ ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pZyBTdQV7a"},{"type":"inlineCode","value":"generate_response","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w3yv1d1X6F"},{"type":"text","value":" èŠ‚ç‚¹çš„ ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CiUA6KFKLj"},{"type":"inlineCode","value":"state","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j8764Kr8Lu"},{"type":"text","value":" çš„ schema ä¸ä¸Šæ¸¸èŠ‚ç‚¹ä¸åŒã€‚å› ä¸º ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u7EKKpJAgb"},{"type":"inlineCode","value":"generate_response","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IdCW5N9SUI"},{"type":"text","value":" èŠ‚ç‚¹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¿™ä¸ª schema æ˜¯ç‰¹æ®Šçš„ï¼Œä¸éœ€è¦ä¸å…¨å±€ schemaï¼ˆ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sHUWEW7QRy"},{"type":"inlineCode","value":"Overall","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VePGeR72QM"},{"type":"text","value":"ï¼‰ç›¸åŒã€‚","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OFSOrL7t3g"}],"key":"YJbbNA3FOR"}],"kind":"note","class":"simple","key":"SZ6yOnvCm1"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"4ï¼‰ç¼–è¯‘å›¾","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MS5lV5Br8T"}],"key":"tCfvf7dgde"}],"key":"gndXkUoDou"}],"key":"fl6I6LMNRr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# åˆ›å»ºå›¾\nbuilder = StateGraph(Overall)\n\n# æ·»åŠ èŠ‚ç‚¹\nbuilder.add_node(\"generate_response\", generate_response)\nbuilder.add_node(\"best_response\", best_response)\n\n# æ·»åŠ è¾¹\nbuilder.add_conditional_edges(START, continue_to_responses, [\"generate_response\"])\nbuilder.add_edge(\"generate_response\", \"best_response\")\nbuilder.add_edge(\"best_response\", END)\n\n# ç¼–è¯‘å›¾\nmy_graph = builder.compile(name='best-response')\nmy_graph","key":"wyR1addnN5"},{"type":"outputs","id":"P4zMAA_ryiFO1QoGJtOZD","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"73c22be132954dcf9b125f0fcb53a703","path":"/73c22be132954dcf9b125f0fcb53a703.png"},"text/plain":{"content":"<langgraph.graph.state.CompiledStateGraph object at 0x10bf1b4d0>","content_type":"text/plain"}}},"children":[],"key":"YoWXJdOn9J"}],"key":"FMPj6snPIq"}],"key":"if5fOOgQFW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# è°ƒç”¨å›¾\nroles = [\"ç”·ç¥\", \"æš–ç”·\", \"æµ·ç‹\", \"ç—´æƒ…ç”·\", \"å†³ç»çš„ç”·ç”Ÿ\", \"èŒ¶èŒ¶çš„ç”·ç”Ÿ ğŸ’…ğŸ’…ğŸ’…\",\n         \"ç†æƒ³ä¸»ä¹‰çš„ç”·ç”Ÿ\", \"å–œæ¬¢å”å˜˜çš„ç”·ç”Ÿ\", \"å¤§ç”·å­ä¸»ä¹‰çš„ç”·ç”Ÿ\", \"äºŒæ¬¡å…ƒè‚¥å®…\"]\nresponse = my_graph.invoke({\"roles\": roles})","key":"ive9BsY3rf"},{"type":"outputs","id":"l-UFWtROpEqJY1smzFg9t","children":[],"key":"u1RrW2hmwz"}],"key":"A1TNtP7spc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for role, resp in zip(roles, response[\"responses\"]):\n    print(f\"ã€{role}ã€‘\")\n    print(resp)\n    print()","key":"RAh6Y0iAML"},{"type":"outputs","id":"gt3003tkuQfw7Tr7eIuHT","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"ã€ç”·ç¥ã€‘\nçœ‹æ¥æˆ‘çš„æ¶ˆæ¯åœ¨ä½ é‚£å„¿æˆäº†æœªè¯»çš„æ˜Ÿè¾°ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œç­‰ä½ æŠ¬å¤´æ—¶ï¼Œæˆ‘ä¾ç„¶åœ¨é—ªè€€ã€‚\n\nã€æš–ç”·ã€‘\næ²¡å…³ç³»ï¼Œç­‰ä½ æ–¹ä¾¿çš„æ—¶å€™å†èŠï¼Œæˆ‘ä¸€ç›´éƒ½åœ¨ï½\n\nã€æµ·ç‹ã€‘\nåˆšåœ¨å¿™ï¼Œæ²¡çœ‹åˆ°æ¶ˆæ¯ï½ä¸è¿‡ä½ ä¸€ä¸Šçº¿ï¼Œæˆ‘çš„å¿ƒå°±è‡ªåŠ¨å¼¹çª—æé†’äº†âœ¨\n\nã€ç—´æƒ…ç”·ã€‘\næ²¡å…³ç³»ï¼Œç­‰ä½ æœ‰ç©ºçš„æ—¶å€™å†å›æˆ‘å°±å¥½ï¼Œæˆ‘ä¸€ç›´éƒ½åœ¨ã€‚\n\nã€å†³ç»çš„ç”·ç”Ÿã€‘\næ—¢ç„¶ä½ æ€»æ˜¯ä¸å›æ¶ˆæ¯ï¼Œé‚£æˆ‘ä¹Ÿä¸æ‰“æ‰°äº†ï¼Œç¥ä½ ä¸€åˆ‡å®‰å¥½ã€‚\n\nã€èŒ¶èŒ¶çš„ç”·ç”Ÿ ğŸ’…ğŸ’…ğŸ’…ã€‘\nå®ï½æ˜¯åœ¨å¿™å—ï¼ŸèŒ¶èŒ¶ç­‰ä½ å›æ¶ˆæ¯ç­‰åˆ°èŠ±éƒ½è°¢å•¦ï½ğŸ’…âœ¨\n\nã€ç†æƒ³ä¸»ä¹‰çš„ç”·ç”Ÿã€‘\næ²¡å…³ç³»ï¼Œæˆ‘ç†è§£ä½ å¯èƒ½åœ¨å¿™ï¼›æ„¿ä½ ä¸€åˆ‡å®‰å¥½ï¼Œç­‰ä½ æœ‰ç©ºæ—¶å†èŠã€‚\n\nã€å–œæ¬¢å”å˜˜çš„ç”·ç”Ÿã€‘\nçœ‹æ¥æˆ‘çš„æ¶ˆæ¯åˆåœ¨ä½ çš„å·²è¯»ä¸å›åˆ—è¡¨é‡Œèººå¹³äº†ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ç»§ç»­åšé‚£ä¸ªé»˜é»˜ç­‰ä½ å›çœ¸çš„å‚»ç“œå§ã€‚\n\nã€å¤§ç”·å­ä¸»ä¹‰çš„ç”·ç”Ÿã€‘\næˆ‘å°Šé‡ä½ çš„æ—¶é—´å’Œç©ºé—´ï¼Œç­‰ä½ æ„¿æ„å›æˆ‘æ—¶ï¼Œæˆ‘ä¾ç„¶åœ¨è¿™é‡Œã€‚\n\nã€äºŒæ¬¡å…ƒè‚¥å®…ã€‘\nå¥³ç¥å¤§äººä»Šå¤©ä¹Ÿåœ¨å¿™ç€æ‹¯æ•‘ä¸–ç•Œå§â€¦é‚£æˆ‘å°±ä¸æ‰“æ‰°å•¦ (à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§\n\n"},"children":[],"key":"pEiTajZ1Ka"}],"key":"tFFEC7qExy"}],"key":"TgjPAaoEXe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"æœ€ä½³å›å¤ï¼š\", response[\"best_response\"])","key":"iYD1UjFkPI"},{"type":"outputs","id":"g86Dj-AqrPNLyGUc6HdK9","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"æœ€ä½³å›å¤ï¼š æ²¡å…³ç³»ï¼Œç­‰ä½ æ–¹ä¾¿çš„æ—¶å€™å†èŠï¼Œæˆ‘ä¸€ç›´éƒ½åœ¨ï½\n"},"children":[],"key":"x0j8aB8MV2"}],"key":"H5HwN4yJn8"}],"key":"xIpcoaGGZ5"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"X9cxnld8zs"}],"key":"tpMNxbB3yR"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"\næ„Ÿè§‰ LangGraph æŠŠå¹¶è¡Œå†™å¤æ‚äº†ã€‚ç”¨ ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TksXcEqMnk"},{"type":"link","url":"https://docs.python.org/3/library/multiprocessing.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"multiprocessing","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HatJI3LPiy"}],"urlSource":"https://docs.python.org/3/library/multiprocessing.html","key":"UiutwHfdqi"},{"type":"text","value":" å†™ä¸€ä¸ª toolï¼Œä¹Ÿè®¸ä¼šæ›´ç®€å•ã€‚","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hDn7RA68mM"}],"key":"HnzQjf1acw"}],"kind":"note","class":"simple","key":"vOdw8onRzQ"}],"key":"zkZvNj0IQh"}],"key":"s5jDHotfT5"},"references":{"cite":{"order":[],"data":{}}}}