{"version":3,"kind":"Notebook","sha256":"f95c78992eaeb6d02f148eb90326c6cfcd65a88850620588d7686d654e2502f1","slug":"supervisor","location":"/8.supervisor.ipynb","dependencies":[],"frontmatter":{"title":"监督者模式","content_includes_title":false,"kernelspec":{"name":"py313","display_name":"Python (py3.13)","language":"python"},"authors":[{"nameParsed":{"literal":"Larry Li","given":"Larry","family":"Li"},"name":"Larry Li","id":"contributors-Users\\Lenovo\\Desktop\\product\\dive-into-langgraph-plus\\myst-generated-uid-0"}],"github":"https://github.com/LarryLi93/dive-into-langgraph-plus","exports":[{"format":"ipynb","filename":"8.supervisor.ipynb","url":"/8.supervisor-93218d9108a2fb726232512a96a8f392.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/multi-agent#multi-agent","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"多智能体系统","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RSTX9V5ci3"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/multi-agent#multi-agent","key":"qVejZB3IeN"},{"type":"text","value":"（MAS, Multi-Agent Systems）有很多种模式，比如 Supervisor 和 Handoff。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vCRERVGXNH"}],"key":"YYwgQu2keo"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"目前最实用的依然是监督者模式（Supervisor）。它的工作流程是这样的：","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wREAFjYi39"}],"key":"xpoKUPTXFs"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"一个 Agent 充当监督者，负责将任务拆解成具体步骤，交给 ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jLTBbvVYr3"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"工具节点","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"B675SJOsMx"}],"key":"aYz6UwMLNG"},{"type":"text","value":" 或 ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"g5nuPhfvA4"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"工具 Agent","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BxAlNG7LMW"}],"key":"vWZxRkT5os"},{"type":"text","value":" 执行","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eG6eHqm62y"}],"key":"RdOXDo7LCC"}],"key":"pZsvJiWfjU"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"工作节点将执行结果返回给监督者，再由监督者汇总结果，返回给用户","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Z4TP9ujoZO"}],"key":"TRlDTvOWiu"}],"key":"nMCKCHmlnc"}],"key":"Y04u5j9GFW"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"执行流程如下：","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"KZqQJNVger"}],"key":"ZOgndivaEx"},{"type":"mermaid","value":"flowchart LR\n    A[用户] --> B[Supervisor]\n    B -.-> C[工具节点]\n    B -.-> D[工具Agent 1]\n    B -.-> E[工具Agent 2]\n    C -.-> B\n    D -.-> B\n    E -.-> B\n    B --> F[AI回复]","position":{"start":{"line":12,"column":1},"end":{"line":22,"column":1}},"key":"NadyMH549w"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"在 LangGraph 中，有两种实现监督者模式的具体方法：","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"S8mySs14Su"}],"key":"mzgyh6PzVH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":26,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"使用 LangChain 的 ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"kvbzKSpFSJ"},{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/multi-agent#tool-calling","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"tool-calling","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"qdxQ4SktKq"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/multi-agent#tool-calling","key":"OXCQTbdwTE"},{"type":"text","value":" 实现","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"XQpkpKcnHp"}],"key":"VKyuBC2g3s"}],"key":"EeCiaGYoQU"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"使用 ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"cMy0PIKaM5"},{"type":"link","url":"https://github.com/langchain-ai/langgraph-supervisor-py","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"langgraph​-supervisor","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"Wib3E2qaTN"}],"urlSource":"https://github.com/langchain-ai/langgraph-supervisor-py","error":true,"key":"aMotHePsve"},{"type":"text","value":" 包实现","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"mwyiICTj8c"}],"key":"V1ps8gtvwX"}],"key":"QXJAO02Odf"}],"key":"pjRScBTNKx"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"下面我将依次实现两种方法。","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"OjHZORj38Z"}],"key":"IYryGxL8lc"}],"key":"pJy4CIhItl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\n\nfrom dotenv import load_dotenv\nfrom langchain_openai import ChatOpenAI\nfrom langchain.agents import create_agent\nfrom langchain.agents.middleware import dynamic_prompt, ModelRequest\nfrom langchain_core.tools import tool\nfrom langgraph_supervisor import create_supervisor\n\n# 加载模型配置\n_ = load_dotenv()\n\n# 加载模型\nllm = ChatOpenAI(\n    api_key=os.getenv(\"DASHSCOPE_API_KEY\"),\n    base_url=os.getenv(\"DASHSCOPE_BASE_URL\"),\n    model=\"qwen3-coder-plus\",\n    temperature=0.7,\n)\n\n@tool\ndef add(a: float, b: float) -> float:\n    \"\"\"Add two numbers.\"\"\"\n    return a + b\n\n@tool\ndef multiply(a: float, b: float) -> float:\n    \"\"\"Multiply two numbers.\"\"\"\n    return a * b\n\n@tool\ndef divide(a: float, b: float) -> float:\n    \"\"\"Divide two numbers.\"\"\"\n    return a / b","key":"CYzNZmblI8"},{"type":"outputs","id":"f2MLr-9AN0fmrn_MaaZys","children":[],"key":"d3NwHYFitZ"}],"key":"qPbKo6yn5G"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"一、使用 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mSdM4s0JPc"},{"type":"inlineCode","value":"tool-calling","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uyZH9WOYFy"},{"type":"text","value":" 功能实现","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bjw8n5fic8"}],"identifier":"id-tool-calling","label":"一、使用 tool-calling 功能实现","html_id":"id-tool-calling","implicit":true,"key":"YsVIrLY1Ao"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"我们首先使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zMgQrP8CAy"},{"type":"inlineCode","value":"create_agent","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ztYXdyhGX4"},{"type":"text","value":" 创建 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BMiZQ0iCDc"},{"type":"inlineCode","value":"subagent1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MGXRUMachc"},{"type":"text","value":" 和 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aU9gCK08Rx"},{"type":"inlineCode","value":"subagent2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HbhwaNC5qd"},{"type":"text","value":"，分别用于计算 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zohjUzksBr"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"两数相加","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ym6Yuy6KwC"}],"key":"rQ6n17NnZV"},{"type":"text","value":" 和 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jv63fqki0B"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"两数相乘","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kq4RcHC3Sd"}],"key":"qUfVxoZGgp"},{"type":"text","value":"。然后使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oqiJB7VymP"},{"type":"inlineCode","value":"@tool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BIE19Hf44L"},{"type":"text","value":" 装饰器包装两个 Agent，做成 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U9OXm2As36"},{"type":"inlineCode","value":"call_subagent1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ut9oKtuoEc"},{"type":"text","value":" 和 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rbGyHdGbc4"},{"type":"inlineCode","value":"call_subagent2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"v0GxZ5AX0B"},{"type":"text","value":"两个工具，它们仅传出 Agent 的最后一条信息。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tmQiyeINMI"}],"key":"TWLY31YvuB"}],"key":"kN5ZiX8fCg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 创建subagent1：用于计算两数相加\nsubagent1 = create_agent(\n    model=llm,\n    tools=[add],\n    name=\"subagent-1\",\n)\n\n@tool(\n    \"subagent-1\",\n    description=\"可以准确地计算两数相加\"\n)\ndef call_subagent1(query: str):\n    result = subagent1.invoke({\n        \"messages\": [{\"role\": \"user\", \"content\": query}]\n    })\n    return result[\"messages\"][-1].content\n\n# 创建subagent2：用于计算两数相乘\nsubagent2 = create_agent(\n    model=llm,\n    tools=[multiply],\n    name=\"subagent-2\",\n)\n\n@tool(\n    \"subagent-2\",\n    description=\"可以准确地计算两数相乘\"\n)\ndef call_subagent2(query: str):\n    result = subagent2.invoke({\n        \"messages\": [{\"role\": \"user\", \"content\": query}]\n    })\n    return result[\"messages\"][-1].content","key":"PdtfzyqeYT"},{"type":"outputs","id":"5O-PUE6HOWWDTMz4Ac5_D","children":[],"key":"hNGi7yIHYZ"}],"key":"GNeibMEnvK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"现在，我们可以将 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IWzSwOxlae"},{"type":"inlineCode","value":"call_subagent1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YQEVHadhBQ"},{"type":"text","value":"、","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zpVAFAWNeI"},{"type":"inlineCode","value":"call_subagent2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tFdB7gEiks"},{"type":"text","value":"、","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KFcBmtQxq3"},{"type":"inlineCode","value":"divide","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"usZs3OYrkz"},{"type":"text","value":" 作为工具，直接传入 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m8blMTQ67A"},{"type":"inlineCode","value":"supervisor_agent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rgapxrB2Lg"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U2LBQudMN0"}],"key":"m8VNYBnsvc"}],"key":"oEaP8jTTtk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 创建supervisor agent\nsupervisor_agent = create_agent(\n    model=llm,\n    tools=[call_subagent1, call_subagent2, divide],\n    name=\"supervisor-agent\",\n    system_prompt=\"提示：如遇两数相减仍可用两数相加工具实现，只需将一个数加上另一个数的负数\",\n)","key":"sZwOw1nACI"},{"type":"outputs","id":"rVgXwx4y8L52QVBxCEVOm","children":[],"key":"OW62fTayjB"}],"key":"DmvJbAxeUO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"下面，我们来计算 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YuGIwYCjj6"},{"type":"inlineCode","value":"38462 + 378 / 49 * 83723 - 123","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o9pYQjaV6Q"},{"type":"text","value":"，看它能否正确地使用所有工具。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PU2ZrDqxv8"}],"key":"gdYQ1bEqmp"}],"key":"Uukx0NfS2U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"result = supervisor_agent.invoke({\n    \"messages\": [{\"role\": \"user\", \"content\": \"计算 38462 + 378 / 49 * 83723 - 123 的结果\"}]}\n)\n\nfor message in result[\"messages\"]:\n    message.pretty_print()","key":"wtV7doGQqy"},{"type":"outputs","id":"H9N3KCfC4ePkJn0ZmhI3B","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"================================\u001b[1m Human Message \u001b[0m=================================\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  divide (call_83dc96bc049d4d15b71bf140)\n Call ID: call_83dc96bc049d4d15b71bf140\n  Args:\n    a: 378\n    b: 49\n  subagent-1 (call_234a141c309d48c2982fdcf0)\n Call ID: call_234a141c309d48c2982fdcf0\n  Args:\n    query: 38462 + -123\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: divide\n\n7.714285714285714\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: subagent-1\n\nThe result of adding 38462 and -123 is 38339.0.\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  subagent-2 (call_2f4458c0a6674198a4f7c94e)\n Call ID: call_2f4458c0a6674198a4f7c94e\n  Args:\n    query: 7.714285714285714 * 83723\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: subagent-2\n\nThe result of multiplying 7.714285714285714 by 83723 is 645863.1428571428.\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  subagent-1 (call_30982c4d06494c63be737350)\n Call ID: call_30982c4d06494c63be737350\n  Args:\n    query: 38339.0 + 645863.1428571428\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: subagent-1\n\nThe sum of 38339.0 and 645863.1428571428 is 684202.1428571428.\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n最终的计算结果是 684202.1428571428。\n"},"children":[],"key":"UZGjiOIsmW"}],"key":"Fx4sQrAVni"}],"key":"xv1SfWr03F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 验证结果是否正确\n38462 + 378 / 49 * 83723 - 123","key":"NN26Mc2sw1"},{"type":"outputs","id":"f0FFk6JMShY7GcrTgFTOk","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"684202.1428571428","content_type":"text/plain"}}},"children":[],"key":"SgeprW3DYK"}],"key":"Y8B6NmTfkv"}],"key":"HsI2Y6xPeP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"二、使用 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cS454iA9UH"},{"type":"inlineCode","value":"langgraph-supervisor","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HMRlgRSQoe"},{"type":"text","value":" 包实现","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N0UykeVUaH"}],"identifier":"id-langgraph-supervisor","label":"二、使用 langgraph-supervisor 包实现","html_id":"id-langgraph-supervisor","implicit":true,"key":"O9vJUJNvju"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"要使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gsN72BE72F"},{"type":"link","url":"https://github.com/langchain-ai/langgraph-supervisor-py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"langgraph​-supervisor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lpUmk4vb6i"}],"urlSource":"https://github.com/langchain-ai/langgraph-supervisor-py","error":true,"key":"xCoLOupLTw"},{"type":"text","value":"，首先需要安装 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EsoVJgAKzC"},{"type":"inlineCode","value":"langgraph-supervisor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"luzGemqF7z"},{"type":"text","value":" 包：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hvylIpuSJn"}],"key":"AokGLdNij6"},{"type":"code","lang":"bash","value":"pip install -U langgraph-supervisor","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"key":"AvYgs5FcPJ"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"langgraph-supervisor","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Cq17dzVWFG"},{"type":"text","value":" 提供了 ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"at2OC95nWE"},{"type":"inlineCode","value":"create_supervisor","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HZVHmHi8So"},{"type":"text","value":" 函数。该函数接受多个 Agent 作为入参，并通过 supervisor 调用它们。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eVga9wqB4f"}],"key":"puzKVTDcDG"}],"key":"GNx6zoncX9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subagent3 = create_agent(\n    model=llm,\n    tools=[divide],\n    name=\"subagent-3\",\n)\n\nsupervisor_graph = create_supervisor(\n    [subagent1, subagent2, subagent3],\n    model=llm,\n    prompt=\"提示：如遇两数相减仍可用两数相加工具实现，只需将一个数加上另一个数的负数\"\n)\n\nsupervisor_app = supervisor_graph.compile()","key":"IK3SMlwErI"},{"type":"outputs","id":"yHi1c15OO2ySBfbFtcXD_","children":[],"key":"YWBjBqzZiU"}],"key":"VPh7uscWxf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"result = supervisor_app.invoke({\n    \"messages\": [{\"role\": \"user\", \"content\": \"计算 38462 + 378 / 49 * 83723 - 123 的结果\"}]}\n)\n\nfor message in result[\"messages\"]:\n    message.pretty_print()","key":"pwOPVF8KB5"},{"type":"outputs","id":"B1PV_KHD5dMwUErpiZcF2","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"================================\u001b[1m Human Message \u001b[0m=================================\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果，我们已经得到了 378 / 49 的结果是 7.714285714285714。接下来，我们需要将这个结果乘以 83723，然后加上 38462，最后减去 123。由于我们没有直接的乘法和加法工具，我们可以分步骤进行。\n\n首先，我们将 7.714285714285714 乘以 83723。由于没有乘法工具，我们可以使用现有的工具来实现。但是，由于我们只有除法工具，我们可以尝试将 83723 除以 1，然后将结果乘以 7.714285714285714。这实际上就是 83723 乘以 7.714285714285714。但是，由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1，然后将结果除以 7.714285714285714 的倒数，即 1 / 7.714285714285714。但是，由于我们没有倒数工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: subagent-3\n\nTransferring back to supervisor\nTool Calls:\n  transfer_back_to_supervisor (530ad923-9d40-445c-8e55-c871c910ae0e)\n Call ID: 530ad923-9d40-445c-8e55-c871c910ae0e\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_back_to_supervisor\n\nSuccessfully transferred back to supervisor\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: supervisor\nTool Calls:\n  transfer_to_subagent-2 (call_fca30434e3004cbf972eeaa4)\n Call ID: call_fca30434e3004cbf972eeaa4\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_to_subagent-2\n\nSuccessfully transferred to subagent-2\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n我们已经得到了 378 / 49 * 83723 的结果是 645863.1428571428。接下来，我们需要将这个结果加上 38462，然后减去 123。由于我们没有加法和减法工具，我们可以使用现有的工具来实现。但是，由于我们只有除法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: subagent-2\n\nTransferring back to supervisor\nTool Calls:\n  transfer_back_to_supervisor (388f7779-6331-42cd-a4be-c03dbd4e6b14)\n Call ID: 388f7779-6331-42cd-a4be-c03dbd4e6b14\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_back_to_supervisor\n\nSuccessfully transferred back to supervisor\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: supervisor\nTool Calls:\n  transfer_to_subagent-1 (call_43d1ded4ec804f60bdb4b75f)\n Call ID: call_43d1ded4ec804f60bdb4b75f\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_to_subagent-1\n\nSuccessfully transferred to subagent-1\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n我们已经得到了 378 / 49 * 83723 + 38462 的结果是 684325.1428571428。接下来，我们需要将这个结果减去 123。由于我们没有减法工具，我们可以使用现有的工具来实现。但是，由于我们只有除法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: subagent-1\n\nTransferring back to supervisor\nTool Calls:\n  transfer_back_to_supervisor (4ff0cf88-1f00-4f0e-bce9-158abae8751c)\n Call ID: 4ff0cf88-1f00-4f0e-bce9-158abae8751c\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_back_to_supervisor\n\nSuccessfully transferred back to supervisor\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: supervisor\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果是 684202.1428571428。\n"},"children":[],"key":"hh3g02yUvx"}],"key":"LU3ZKtRp3j"}],"key":"fOKcbvdJjw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 验证结果是否正确\n38462 + 378 / 49 * 83723 - 123","key":"oPaS4HDw0O"},{"type":"outputs","id":"W8613OsToi_wquBLtcVN1","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"684202.1428571428","content_type":"text/plain"}}},"children":[],"key":"pCrOj6zjgu"}],"key":"nB2LfJ3Vt3"}],"key":"E90MGSYjBi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"别看现在它们都算对了，实际上这是我试了好几遍，并调整了 system prompt 的结果。你多次尝试应该也能 roll 出错误的结果。所以我对多智能体的效果仍有疑虑。我感觉现阶段多智能体是会降低准确性的，能不用就不用。什么时候应该使用多智能体呢？可以参考以下 LangGraph 给的 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bpE1lWfpiF"},{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/multi-agent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"建议","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QMvXB2XDCX"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/multi-agent","key":"VXVw4rAjYS"},{"type":"text","value":"。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AdWuytstMU"}],"key":"ECA6f0eFgW"},{"type":"blockquote","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"多代理系统在以下情况下很有用：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LWZBCiC3Xw"}],"key":"lBo68hNRpF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"单个代理拥有太多工具，并且在使用哪个工具方面做出了错误的决定。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JQzn8M8JET"}],"key":"JsuN5pPp0M"}],"key":"q2rT1Y1C9H"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"上下文或内存变得太大，一个代理无法有效跟踪。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WwX4qWpD73"}],"key":"xutbOOPDzE"}],"key":"APuvEJIX0w"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"任务需要专业化 （例如，规划师、研究人员、数学专家）。","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GVtcL9J0nk"}],"key":"dZBekxCuJt"}],"key":"ekjmpZ2nzr"}],"key":"kbVaunpK17"}],"key":"wAHKwDNPZC"}],"key":"tIHAeCw7s9"}],"key":"W2yvRiJacA"},"references":{"cite":{"order":[],"data":{}}}}